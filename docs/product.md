# 产品需求文档 (PRD)

## Discord Bilibili 音频机器人

### 1. 项目概述

**产品名称:** Bilibili 音频机器人  
**版本:** 1.0  
**日期:** 2025 年 9 月 1 日
**团队:** 个人开发者

#### 1.1 执行摘要

Bilibili 音频机器人是一个设计用于将 Bilibili 视频的音频内容直接流式传输到 Discord 语音频道的 Discord 机器人。用户可以分享 Bilibili 视频 URL，并让音频实时播放给所有语音频道参与者，创造共享的听觉体验。

#### 1.2 项目目标

- 实现从 Bilibili 视频到 Discord 语音频道的无缝音频流传输
- 通过 Discord 斜杠命令提供直观的用户界面
- 支持多个音频请求的队列管理
- 确保稳定和高质量的音频播放
- 为 Discord 社区创造社交音频分享体验

### 2. 目标用户

#### 2.1 主要用户

- **Discord 社区成员**: 希望一起分享和收听 Bilibili 内容的用户
- **音乐爱好者**: 喜欢协作音乐收听会话的用户

#### 2.2 用户角色

- **社区 DJ**: 为 Discord 服务器管理音乐并希望包含 Bilibili 内容的用户
- **反应者**: 对 Bilibili 视频做出反应并需要音频播放的内容创作者
- **休闲听众**: 偶尔分享有趣 Bilibili 内容的普通 Discord 用户

### 3. 核心功能

#### 3.1 基本功能 (MVP)

1. **URL 处理**

   - 接受 Bilibili 视频 URL（bilibili.com, b23.tv 短链接）
   - 从视频内容中提取音频流
   - 验证 URL 格式和可访问性

2. **音频播放**

   - 将音频流式传输到 Discord 语音频道
   - 支持标准音频格式（MP3, AAC 等）
   - 在流传输过程中保持音频质量

3. **可视化界面**

   - 带有视频信息的富嵌入消息
   - 实时播放进度显示
   - 交互式控制按钮（播放/暂停/跳过/上一首）
   - 视频缩略图和元数据显示
   - 使用 Unicode 字符的可视化进度条

4. **基本控制**

   - 播放/暂停功能
   - 跳到队列中的下一首
   - 返回队列中的上一首

5. **队列管理**
   - 将多个视频添加到队列
   - 显示即将播放的曲目的可视化队列
   - 从队列中移除项目
   - 自动进入下一个视频

#### 3.2 增强功能（未来版本）

1. **高级播放**

   - 跳转功能（跳到特定时间点）
   - 单个视频或整个队列循环
   - 队列随机排序

2. **高级可视化**

   - 音频波形可视化
   - 实时频谱分析器
   - 自定义进度条主题
   - 歌词显示（如果可用）

3. **增强信息显示**
   - 详细视频统计（观看次数、点赞数、上传日期）
   - 用户收听历史
   - 播放分析
   - 队列时间估计

### 4. 技术要求

#### 4.1 平台兼容性

- **Discord API**: 最新的 Discord.js 库
- **Node.js**: 18.x 版本或更高
- **操作系统**: 跨平台（Windows、macOS、Linux）

#### 4.2 外部依赖

- **音频处理**: 用于音频转换的 FFmpeg
- **语音连接**: Discord 语音 API 集成
- **HTTP 请求**: Axios 或类似工具用于 API 调用
- **URL 解析**: 自定义 Bilibili URL 解析器

#### 4.3 性能要求

- **延迟**: 命令后 10 秒内开始音频播放
- **质量**: 保持原始音频质量，最高 320kbps
- **稳定性**: 活跃使用期间 99%的正常运行时间
- **并发用户**: 同时支持多个 Discord 服务器

### 5. 用户界面设计

#### 5.1 Discord 斜杠命令

```
/play [bilibili_url] - 将视频添加到队列并开始播放，带可视化界面
/pause - 暂停当前音频
/resume - 恢复暂停的音频
/prev - 跳到队列中的上一个视频
/skip - 跳到队列中的下一个视频
/queue - 显示带有即将播放曲目的可视化队列
/nowplaying - 显示当前视频的详细信息和控制按钮
```

#### 5.2 交互式可视化界面

**播放控制面板:**

- 带有视频缩略图和信息的富嵌入
- 实时进度条 (█████░░░░░ 50% | 2:34 / 5:12)
- 用于播放/暂停/跳过/上一首的交互式按钮
- 播放期间每 15 秒自动刷新
- 颜色编码状态指示器（绿色=播放中，黄色=已暂停，红色=错误）

**队列显示:**

- 带有缩略图的即将播放曲目的可视化列表
- 队列位置指示器
- 估计等待时间
- 用于重新排序或移除项目的交互式按钮

#### 5.3 机器人响应

- **富嵌入**: 带有缩略图和元数据的视觉吸引力消息
- **交互式组件**: 可点击按钮用于即时控制
- **实时更新**: 自动进度和状态更新
- **视觉反馈**: 颜色编码状态指示器和进度条
- **错误处理**: 用户友好的错误消息，带有有用的建议

### 6. 安全与隐私

#### 6.1 数据处理

- **无数据存储**: 机器人不存储用户数据或视频内容
- **临时处理**: URL 仅在内存中处理
- **速率限制**: 实施请求限制以防止滥用

#### 6.2 内容合规

- **服务条款**: 遵守 Discord 和 Bilibili 的服务条款
- **内容过滤**: 对不适当内容进行基本检查
- **用户责任**: 用户对分享的内容负责

### 7. 错误处理与边缘情况

#### 7.1 常见错误场景

- **无效 URL**: 处理格式错误或无法访问的 Bilibili 链接
- **网络问题**: 优雅处理连接失败
- **语音频道问题**: 处理机器人断开连接和重新连接
- **音频格式问题**: 为不支持的格式提供备选方案

#### 7.2 用户反馈

- **清晰的错误消息**: 解释出了什么问题以及如何修复
- **重试机制**: 对临时失败进行自动重试
- **帮助命令**: 提供使用说明和故障排除

### 8. 实施阶段

#### 阶段 1: 核心功能 (MVP)

- 基本 URL 处理和音频提取
- 简单的播放/暂停/停止控制
- 基本队列管理
- 基本 Discord 集成

#### 阶段 2: 增强功能

- 高级播放控制
- 改进的用户界面
- 更好的错误处理和反馈
- 性能优化

#### 阶段 3: 高级功能

- 用户权限系统
- 高级队列管理
- 统计和分析
- 多服务器优化

### 9. 成功指标

#### 9.1 技术指标

- **响应时间**: 从命令到音频开始 < 10 秒
- **错误率**: < 5%的播放尝试失败
- **正常运行时间**: > 99%的可用性
- **音频质量**: 保持源质量

#### 9.2 用户体验指标

- **命令成功率**: > 95%的命令执行成功
- **用户保留**: 定期使用模式
- **功能采用**: 不同机器人功能的使用情况

### 10. 未来增强

#### 10.1 潜在功能

- **播放列表支持**: 导入并播放 Bilibili 播放列表
- **搜索功能**: 直接从 Discord 搜索 Bilibili
- **集成 API**: 与其他音乐平台连接
- **网页仪表板**: 基于浏览器的控制界面

#### 10.2 可扩展性考虑

- **多服务器架构**: 支持大规模部署
- **负载均衡**: 在多个机器人实例之间分配负载
- **缓存系统**: 缓存经常访问的内容
- **数据库集成**: 存储用户偏好和统计数据

### 11. 风险评估

#### 11.1 技术风险

- **API 变更**: Bilibili 可能更改其视频 API 结构
- **速率限制**: 来自 Bilibili 或 Discord 的潜在限制
- **性能问题**: 音频处理期间的高 CPU 使用率

#### 11.2 缓解策略

- **灵活架构**: 模块化设计便于更新
- **监控系统**: 实时性能监控
- **备份计划**: 需要时使用替代音频源
- **定期更新**: 保持依赖项的最新和安全

---

**文档版本:** 1.0  
**最后更新:** 2025 年 9 月 1 日  
**审核状态:** 草稿  
**批准:** 待定
